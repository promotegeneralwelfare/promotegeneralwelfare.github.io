<!DOCTYPE html>
<html>
  <head>
    <title>Members of Congress</title>
    <meta charset='utf-8'>
    <meta name="description" content="Members of Congress.">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <link href="//netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.css" rel="stylesheet">
    <!--[if IE 7]>
      <link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome-ie7.min.css">
    <![endif]-->
    <link href="css/congress.css" rel="stylesheet" media="screen">
    <!--[if IE 9]>
      <script src="js/html5shiv.js"></script>
    <![endif]-->
    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-44607820-1']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
  </head>

  <body>
    <a href="https://twitter.com/share" class="twitter-share-button" data-text="Check out this tool to find your legislators and let them know how you feel. #governmentshutdown" data-via="PromoteGenWel" data-dnt="true">Tweet</a>
        <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
    <div class="header">
      <hgroup class="vote">
        <h1>VOTE FOR CHANGE</h1>
        <h2 class="steps">Our country needs our help.</h2>
        <h2>Here is a simple tool you can use to voice your concerns today.<br /> But, remember the names and faces of the legislators in your state so when they run for re-election you can speak even louder with your vote.</h2>
      </hgroup>
      <p class="small">* No parties are listed. This isn't a party issue, it's a people issue.</p>
      <form class="inline" id="legislator-search" role="form">
        <div class="input-group">
          <label for="state-name">What state do you live in?</label><br />
          <input id="state-name" placeholder="State" type="text">
        </div>
        <button id="search" type="submit" class="btn" onClick="_gaq.push(['_trackEvent', 'Legislators', 'Search', $('#state-name').val()]);">Find Your Legislators</button>
      </form>
      OR<br />
      <button id="search-all" type="submit" class="btn btn-secondary" onClick="_gaq.push(['_trackEvent', 'Legislators', 'Search', 'All']);">View All Legislators</button>
    </div>

    <div id="legislators"></div>
    <div id="state" class="state"></div>

    <div class="footer">
      <p class="small">Big thanks to the <a href="http://sunlightfoundation.com/">Sunlight Foundation</a> for the <a href="http://sunlightlabs.github.io/congress/index.html">Sunlight Congress API</a> and <a href="http://sunlightlabs.github.io/congress/index.html#bulk-data/legislator-photos">photos</a>, to <a href="http://fortawesome.github.io/Font-Awesome/">Font Awesome</a> for the icons, to <a href="https://github.com">Github</a> for the <a href="http://pages.github.com/">free hosting</a>, and to <a href="http://google.com">Google</a> for the <a href="http://www.google.com/fonts/">fonts</a>.</p>
    </div>

    <script src="js/jquery-1.9.1.min.js"></script>
    <script src="js/typeahead.min.js"></script>
    <script type="text/javascript">
      $(document).ready(function() {
        $("#legislator-search").submit(function(){
          return false;
        });

        // initialize the state typeahead
        var state_type = $('#state-name').typeahead([ {
          name: 'states',
          prefetch: 'data/states.json',
          limit: 20
        }]);

        $("#search, #search-all").click(function() {
          // clear results
          $("#legislators, #state").html("");
          var inputState = $("#state-name").val().replace(/ /g, "%20");
          var searchURL = "http://congress.api.sunlightfoundation.com/legislators?apikey=c9d6acff9f004d7aacad8984d1844cce&per_page=all&order=state__asc,title__desc&state_name=" + inputState;
          if (this.id == "search-all") {
            $("#legislators").css("display", "block");
            $("#state").css("display", "none");
            searchURL = "data/legislators.json";
            $.ajax({
              url: searchURL,
              dataType: 'json',
              success:function(results) {
                var count = 0;
                var state = "";
                var title = "";
                var htmlstring = "";
                // alert (results.length);
                $.each(results.results, function(key, value) {
                  // if title isn't null
                  if (title != "" && title != value.title) {
                    htmlstring = htmlstring + '</div>';
                  }

                  // if state isn't null and its a new state
                  if (state != "" && state != value.state_name) {
                    htmlstring = htmlstring + '</div>';
                    $("#legislators").append(htmlstring);
                    htmlstring = "";
                  }

                  // if a new state output a state wrapper and the state name
                  if (state != value.state_name) {
                    htmlstring = htmlstring + '<div class="state clearfix"><h1>' + value.state_name + '</h1>';
                  }

                  // if a new title (rep or sen) output a rep/sen wrapper
                  if (title != value.title) {
                    htmlstring = htmlstring + '<div class="title clearfix"><h2>';
                    if (value.title == "Rep") {
                      htmlstring = htmlstring + "Representatives";
                    } else if (value.title = "Sen") {
                      htmlstring = htmlstring + "Senators";
                    } else if (value.title = "Del") {
                      htmlstring = htmlstring + 'Delegates';
                    }
                    htmlstring = htmlstring + '</h2>';
                  }

                  // output the person
                  htmlstring = htmlstring + '<div class="person">';
                  htmlstring = htmlstring + '<h3>' + value.title + '. ' + value.first_name + ' ';
                  if (value.middle_name != null) {
                    htmlstring = htmlstring + value.middle_name + ' ';
                  }
                  htmlstring = htmlstring + value.last_name + '</h3>'
                  htmlstring = htmlstring + '<p>of ' + value.state_name + '</p>';
                  htmlstring = htmlstring + '<img src="img/' + value.bioguide_id + '.jpg" />';
                  htmlstring = htmlstring + '<div class="contact-info">';
                  htmlstring = htmlstring + '<ul class="clearfix">';
                  htmlstring = htmlstring + '<li><a class="facebook" href="https://facebook.com/' + value.facebook_id + '"><i class="icon-facebook-sign"></i></a></li>';
                  htmlstring = htmlstring + '<li><a class="twitter" href="https://twitter.com/' + value.twitter_id + '"><i class="icon-twitter-sign"></i></a></li>';
                  htmlstring = htmlstring + '<li><a class="email" href="' + value.contact_form + '"><i class="icon-envelope"></i></a></li>';
                  htmlstring = htmlstring + '</ul>';
                  htmlstring = htmlstring + '<p><i class="icon-phone"></i> ' + value.phone + '</p>';
                  htmlstring = htmlstring + '<p class="term-end"><i class="icon-check-sign"></i> Term Ends - ' + value.term_end + '</p>';
                  htmlstring = htmlstring + '</div>';
                  htmlstring = htmlstring + '</div>';

                  // reset the state
                  state = value.state_name;
                  title = value.title;

                  if (value.state_name == "American Samoa" || value.state_name == "District of Columbia" || value.state_name == "Guam" || value.state_name == "Northern Mariana Islands" || value.state_name == "Puerto Rico" || value.state_name == "US Virgin Islands") {
                    // close title div
                    htmlstring = htmlstring + '</div>';
                    // reset the title
                    title = "asdf";
                  }
                  if (key >= results.results.length - 1) {
                    htmlstring = htmlstring + '</div></div>';
                    $("#legislators").append(htmlstring);
                  }
                });
              },
              error: function(xhr, status, error) {
                $.get('templates/stations.html', function(templates) {
                  var template = $(templates).filter('#stations-api-error').html();
                  var html = Mustache.to_html(template);
                  $("#station-notify").html(html).fadeIn(1000);
                });
              }
            });






          } else {
            $("#legislators").css("display", "none");
            $("#state").css("display", "block").append('<h1>' + $("#state-name").val() + '</h1>');
            $.ajax({
              url: searchURL,
              dataType: 'json',
              success:function(results) {
                var count = 0;
                var state = "";
                var title = "";
                var htmlstring = '';
                $.each(results.results, function(key, value) {
                  // if title isn't null
                  if (title != "" && title != value.title) {
                    htmlstring = htmlstring + '</div>';
                    $("#state").append(htmlstring);
                    htmlstring = "";
                  }

                  // if a new title (rep or sen) output a rep/sen wrapper
                  if (title != value.title) {
                    htmlstring = htmlstring + '<div class="title clearfix"><h2>';
                    if (value.title == "Rep") {
                      htmlstring = htmlstring + "Representatives";
                    } else if (value.title = "Sen") {
                      htmlstring = htmlstring + "Senators";
                    } else if (value.title = "Del") {
                      htmlstring = htmlstring + 'Delegates';
                    }
                    htmlstring = htmlstring + '</h2>';
                  }

                  // output the person
                  htmlstring = htmlstring + '<div class="person">';
                  htmlstring = htmlstring + '<h3>' + value.title + '. ' + value.first_name + ' ';
                  if (value.middle_name != null) {
                    htmlstring = htmlstring + value.middle_name + ' ';
                  }
                  htmlstring = htmlstring + value.last_name + '</h3>'
                  htmlstring = htmlstring + '<p>of ' + value.state_name + '</p>';
                  htmlstring = htmlstring + '<img src="img/' + value.bioguide_id + '.jpg" />';
                  htmlstring = htmlstring + '<div class="contact-info">';
                  htmlstring = htmlstring + '<ul class="clearfix">';
                  htmlstring = htmlstring + '<li><a class="facebook" href="https://facebook.com/' + value.facebook_id + '"><i class="icon-facebook-sign"></i></a></li>';
                  htmlstring = htmlstring + '<li><a class="twitter" href="https://twitter.com/' + value.twitter_id + '"><i class="icon-twitter-sign"></i></a></li>';
                  htmlstring = htmlstring + '<li><a class="email" href="' + value.contact_form + '"><i class="icon-envelope"></i></a></li>';
                  htmlstring = htmlstring + '</ul>';
                  htmlstring = htmlstring + '<p><i class="icon-phone"></i> ' + value.phone + '</p>';
                  htmlstring = htmlstring + '<p class="term-end"><i class="icon-check-sign"></i> Term Ends - ' + value.term_end + '</p>';
                  htmlstring = htmlstring + '</div>';
                  htmlstring = htmlstring + '</div>';

                  // reset the title
                  title = value.title;

                  if (key >= results.results.length - 1) {
                    htmlstring = htmlstring + '</div>';
                    $("#state").append(htmlstring);
                  }
                });
              },
              error: function(xhr, status, error) {
                $.get('templates/stations.html', function(templates) {
                  var template = $(templates).filter('#stations-api-error').html();
                  var html = Mustache.to_html(template);
                  $("#station-notify").html(html).fadeIn(1000);
                });
              }
            });
            //$("#legislators").append(htmlstring + '</div>');
          }
        });
      });
    </script>
  </body>
</html>