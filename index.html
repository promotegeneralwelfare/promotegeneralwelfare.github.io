<!DOCTYPE html>
<html>
  <head>
    <title>Members of Congress</title>
    <meta charset='utf-8'>
    <meta name="description" content="Members of Congress.">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <link href="//netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.css" rel="stylesheet">
    <!--[if IE 7]>
      <link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome-ie7.min.css">
    <![endif]-->
    <link href="css/congress.css" rel="stylesheet" media="screen">
    <!--[if IE 9]>
      <script src="js/html5shiv.js"></script>
    <![endif]-->
  </head>

  <body>
    <div class="header">
      <hrgoup>
        <h2>We the People of the United States, in Order to form a more perfect Union, establish Justice, insure domestic Tranquility, provide for the common defence, <u>promote the general Welfare</u>, and secure the Blessings of Liberty to ourselves and our Posterity, do ordain and establish this Constitution for the United States of America.</h2>
      </hgroup>
    </div>

    <script src="js/jquery-1.9.1.min.js"></script>
    <script type="text/javascript">
      $(document).ready(function() {
       $.ajax({
          url: "/data/legislators.json",
          dataType: 'json',
          success:function(results) {
            var count = 0;
            var state = "";
            var title = "";
            var htmlstring = "";
            $.each(results.results, function(key, value) {
              // if title isn't null
              if (title != "" && title != value.title) {
                htmlstring = htmlstring + '</div>';
              }

              // if state isn't null and its a new state
              if (state != "" && state != value.state_name) {
                htmlstring = htmlstring + '</div>';
                $("body").append(htmlstring);
                htmlstring = "";
              }

              // if a new state output a state wrapper and the state name
              if (state != value.state_name) {
                htmlstring = htmlstring + '<div class="state clearfix"><h1>' + value.state_name + '</h1>';
              }

              // if a new title (rep or sen) output a rep/sen wrapper
              if (title != value.title) {
                htmlstring = htmlstring + '<div class="title clearfix"><h2>';
                if (value.title == "Rep") {
                  htmlstring = htmlstring + "Representatives";
                } else if (value.title = "Sen") {
                  htmlstring = htmlstring + "Senators";
                } else if (value.title = "Del") {
                  htmlstring = htmlstring + 'Delegates';
                }
                htmlstring = htmlstring + '</h2>';
              }

              // output the person
              htmlstring = htmlstring + '<div class="person">';
              htmlstring = htmlstring + '<h3>' + value.title + '. ' + value.first_name + ' ';
              if (value.middle_name != null) {
                htmlstring = htmlstring + value.middle_name + ' ';
              }
              htmlstring = htmlstring + value.last_name + '</h3>'
              htmlstring = htmlstring + '<p>of ' + value.state_name + '</p>';
              htmlstring = htmlstring + '<img src="img/' + value.bioguide_id + '.jpg" />';
              htmlstring = htmlstring + '<div class="contact-info">';
              htmlstring = htmlstring + '<ul class="clearfix">';
              htmlstring = htmlstring + '<li><a class="facebook" href="https://facebook.com/' + value.facebook_id + '"><i class="icon-facebook-sign"></i></a></li>';
              htmlstring = htmlstring + '<li><a class="twitter" href="https://twitter.com/' + value.twitter_id + '"><i class="icon-twitter-sign"></i></a></li>';
              htmlstring = htmlstring + '<li><a class="email" href="' + value.contact_form + '"><i class="icon-envelope"></i></a></li>';
              htmlstring = htmlstring + '</ul>';
              htmlstring = htmlstring + '<p><i class="icon-phone"></i> ' + value.phone + '</p>';
              htmlstring = htmlstring + '<p class="term-end"><i class="icon-check-sign"></i> Term Ends - ' + value.term_end + '</p>';
              htmlstring = htmlstring + '</div>';
              htmlstring = htmlstring + '</div>';

              // reset the state
              state = value.state_name;
              title = value.title;

              if (value.state_name == "American Samoa" || value.state_name == "District of Columbia" || value.state_name == "Guam" || value.state_name == "Northern Mariana Islands" || value.state_name == "Puerto Rico" || value.state_name == "US Virgin Islands") {
                // close title div
                htmlstring = htmlstring + '</div>';
                // reset the title
                title = "asdf";
              }
            });
          },
          error: function(xhr, status, error) {
            $.get('templates/stations.html', function(templates) {
              var template = $(templates).filter('#stations-api-error').html();
              var html = Mustache.to_html(template);
              $("#station-notify").html(html).fadeIn(1000);
            });
          }
        });
      });
    </script>
  </body>
</html>